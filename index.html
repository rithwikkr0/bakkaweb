<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bakka's World üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --pink: #ff7eb3;
      --pink-soft: #ffd1e8;
      --blue: #7bb6ff;
      --purple: #b388ff;
      --bg-glass: rgba(255, 255, 255, 0.12);
      --border-glass: rgba(255, 255, 255, 0.3);
      --text-main: #ffffff;
      --text-muted: #e0d9ff;
      --danger: #ff4b6e;
      --success: #2ecc71;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      background: radial-gradient(circle at top, #ff9a9e 0%, #fad0c4 30%, #a18cd1 100%);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 10px;
    }

    .app-root {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.15));
      border-radius: 24px;
      border: 1px solid var(--border-glass);
      backdrop-filter: blur(18px);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
      background: linear-gradient(120deg, rgba(255,255,255,0.18), rgba(255,255,255,0.03));
    }

    .app-title {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .app-subtitle {
      font-size: 0.95rem;
      opacity: 0.9;
    }

    .life-counter {
      margin-top: 4px;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: radial-gradient(circle at top, var(--pink), var(--blue));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    .nav-bar {
      display: flex;
      overflow-x: auto;
      padding: 6px 10px 6px;
      gap: 6px;
      background: rgba(0,0,0,0.1);
    }

    .nav-tab {
      border: none;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      color: #fff;
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
      transition: 0.15s;
    }

    .nav-tab-active {
      background: linear-gradient(90deg, var(--pink), var(--blue));
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .app-main {
      flex: 1;
      overflow-y: auto;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card {
      background: var(--bg-glass);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }

    .card-header h2 {
      margin: 0 0 4px;
      font-size: 1.2rem;
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    /* Buttons & inputs */

    .primary-btn,
    .secondary-btn,
    .link-btn,
    .icon-btn {
      font-family: inherit;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .primary-btn {
      background: linear-gradient(120deg, var(--pink), var(--blue));
      color: #fff;
      padding: 8px 16px;
      border: 1px solid rgba(255,255,255,0.4);
    }

    .secondary-btn {
      background: rgba(255,255,255,0.12);
      color: #fff;
      padding: 6px 14px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .secondary-btn.small,
    .primary-btn.small {
      padding: 4px 12px;
      font-size: 0.78rem;
    }

    .btn-active {
      outline: 2px solid var(--blue);
    }

    .link-btn {
      background: none;
      color: var(--pink-soft);
      padding: 0;
      text-decoration: underline;
      font-size: 0.8rem;
    }

    .link-btn.danger {
      color: var(--danger);
    }

    .icon-btn {
      background: rgba(255,255,255,0.14);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 3px;
    }

    input, select, textarea {
      font-family: inherit;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.4);
      padding: 6px 10px;
      background: rgba(0,0,0,0.25);
      color: #fff;
      font-size: 0.85rem;
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(230,230,255,0.6);
    }

    .form-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0 10px;
    }

    .form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 6px 0 10px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 0.8rem;
    }

    textarea {
      resize: vertical;
    }

    /* Slideshow */

    .slideshow {
      margin-top: 10px;
    }

    .slideshow-inner {
      border-radius: 16px;
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.25);
    }

    .slideshow-image-wrap {
      position: relative;
      max-height: 350px;
      overflow: hidden;
    }

    .slideshow-image {
      width: 100%;
      display: block;
      object-fit: cover;
    }

    .slideshow-date {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      font-size: 0.75rem;
    }

    .slideshow-desc {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px 10px;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      font-size: 0.85rem;
    }

    .slideshow-controls,
    .home-music-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .home-music-buttons {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    /* Timeline memories */

    .timeline-wrapper {
      position: relative;
      margin-top: 10px;
      padding: 14px 0;
    }

    .timeline-line {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 2px;
      background: linear-gradient(to bottom, var(--pink), var(--blue));
      opacity: 0.8;
    }

    .zig-item {
      position: relative;
      display: flex;
      margin: 12px 0;
    }

    .zig-item.left {
      justify-content: flex-start;
    }

    .zig-item.right {
      justify-content: flex-end;
    }

    .zig-node {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .zig-card {
      background: rgba(0,0,0,0.45);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 8px;
      max-width: 48%;
      cursor: pointer;
      transition: 0.15s;
    }

    .zig-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }

    .zig-date {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .zig-thumb {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 4px;
      object-fit: cover;
      max-height: 180px;
    }

    .zig-title {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .zig-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    /* Modals */

    .memory-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .memory-modal-inner {
      max-width: 640px;
      width: 90%;
      background: rgba(15,15,40,0.95);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.35);
      padding: 12px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-image {
      width: 100%;
      border-radius: 12px;
      margin: 6px 0;
    }

    .modal-video {
      width: 100%;
      border-radius: 12px;
      margin: 6px 0;
    }

    /* Music corner */

    .music-playlists {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .songs-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .song-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
    }

    .song-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .song-artist {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .song-tags span {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.15);
      margin-right: 3px;
    }

    /* Todos */

    .todos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .todo-card {
      background: rgba(0,0,0,0.45);
      padding: 8px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      font-size: 0.85rem;
    }

    .todo-card-done {
      border-color: var(--success);
      opacity: 0.85;
    }

    .todo-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .todo-text {
      margin-bottom: 3px;
    }

    .todo-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Diary */

    .diary-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    .diary-card {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 8px;
    }

    .diary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .diary-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .diary-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .diary-content {
      font-size: 0.85rem;
      white-space: pre-wrap;
    }

    .letter-card {
      margin-top: 6px;
      padding: 8px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.18));
      border: 1px solid rgba(255,255,255,0.35);
      max-height: 220px;
      overflow-y: auto;
    }

    .letter-line {
      margin: 2px 0;
      font-size: 0.85rem;
    }

    .letter-editor {
      width: 100%;
      margin-top: 4px;
    }

    /* Hidden space */

    .hidden-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 6px;
      margin-top: 6px;
    }

    .hidden-card {
      background: rgba(0,0,0,0.55);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 6px;
      font-size: 0.8rem;
    }

    .hidden-thumb {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 4px;
    }

    .hidden-video {
      width: 100%;
      border-radius: 10px;
      margin-top: 4px;
    }

    .hidden-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .hidden-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .hidden-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 2px 0 4px;
    }

    /* Player bar */

    .player-bar {
      border-top: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.45);
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.8rem;
    }

    .player-info {
      flex: 1;
      overflow: hidden;
    }

    .player-title {
      font-weight: 600;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .player-artist {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .player-tag {
      font-size: 0.7rem;
      color: var(--pink-soft);
    }

    .player-controls {
      display: flex;
      align-items: center;
    }

    .player-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Birthday overlay */

    .birthday-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .birthday-card {
      width: 90%;
      max-width: 420px;
      background: radial-gradient(circle at top, #ff9a9e, #8e54e9);
      border-radius: 22px;
      padding: 16px;
      text-align: center;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.4);
      box-shadow: 0 18px 40px rgba(0,0,0,0.5);
    }

    .cake-wrapper {
      margin: 10px auto;
      width: 180px;
    }

    .cake-candles {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-bottom: 6px;
    }

    .candle {
      width: 6px;
      height: 22px;
      border-radius: 999px;
      background: #fff;
      position: relative;
    }

    .flame {
      position: absolute;
      top: -9px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 12px;
      border-radius: 50% 50% 40% 40%;
      background: radial-gradient(circle at top, #fffcc1, #ff7e67);
      box-shadow: 0 0 8px rgba(255,200,80,0.9);
    }

    .cake-body {
      position: relative;
    }

    .cake-layer {
      height: 24px;
      border-radius: 18px;
      margin: 2px auto;
      width: 100%;
      background: linear-gradient(90deg, #fff1f7, #ffe0f0);
      border: 1px solid rgba(255,255,255,0.8);
    }

    .cake-layer-top {
      width: 70%;
    }

    .cake-layer-middle {
      width: 85%;
    }

    .cake-layer-bottom {
      width: 100%;
      position: relative;
    }

    .cake-slice {
      position: absolute;
      right: 10px;
      top: -2px;
      width: 40px;
      height: 24px;
      background: linear-gradient(90deg, #ffecec, #ffd2e5);
      border-radius: 10px;
      transform: rotate(-8deg);
      box-shadow: 0 6px 10px rgba(0,0,0,0.3);
    }

    .cake-plate {
      margin-top: 4px;
      width: 90%;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.6);
      margin-inline: auto;
      box-shadow: 0 6px 15px rgba(0,0,0,0.5);
    }

    .wishes-text {
      font-size: 0.9rem;
      margin: 6px 0 10px;
    }

    /* Themes by time */

    .theme-morning .app-root {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
    }
    .theme-day .app-root {
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
    }
    .theme-sunset .app-root {
      background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
    }
    .theme-evening .app-root {
      background: linear-gradient(135deg, #a18cd1, #fbc2eb);
    }
    .theme-night .app-root {
      background: radial-gradient(circle at top, #141e30, #243b55);
    }

    /* Sections */

    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    @media (max-width: 700px) {
      .zig-card {
        max-width: 70%;
      }
    }
  </style>
</head>
<body>
  <div id="theme-wrapper" class="theme-day">
    <div class="app-root">
      <header class="app-header">
        <div>
          <div class="app-title" id="app-title">Bakka's World üíñ</div>
          <div class="app-subtitle" id="app-subtitle">
            <!-- greeting + name -->
          </div>
          <div class="life-counter" id="life-counter"></div>
        </div>
        <div class="avatar" id="avatar-initials">B</div>
      </header>

      <nav class="nav-bar">
        <button class="nav-tab nav-tab-active" data-tab="home">Home</button>
        <button class="nav-tab" data-tab="memories">Memories</button>
        <button class="nav-tab" data-tab="videos">Video Memories</button>
        <button class="nav-tab" data-tab="dreams">Dreams vs Reality</button>
        <button class="nav-tab" data-tab="music">Music Corner</button>
        <button class="nav-tab" data-tab="tasks">Work To Do</button>
        <button class="nav-tab" data-tab="diary">Diary üíå</button>
        <button class="nav-tab" data-tab="settings">Settings</button>
        <button class="nav-tab" data-tab="secret">You üîí</button>
      </nav>

      <main class="app-main">
        <!-- Home -->
        <section id="section-home" class="section active card">
          <div class="card-header">
            <h2>Home üè†</h2>
            <p class="muted">
              A slideshow of your memories with gentle music and a soft theme that
              follows the time of day.
            </p>
          </div>
          <div id="home-slideshow-container"></div>
          <div id="home-slideshow-controls"></div>
        </section>

        <!-- Memories -->
        <section id="section-memories" class="section card">
          <div class="card-header">
            <h2>Memories üì∏</h2>
            <p class="muted">
              Add photos with dates and little stories. They will appear as a zig-zag timeline.
            </p>
          </div>
          <form class="form-inline" id="memories-form">
            <input type="date" id="mem-date" />
            <input type="text" id="mem-image" placeholder="Image path (e.g. /photos/1.jpg)" />
            <input type="text" id="mem-title" placeholder="Title (optional)" />
            <input type="text" id="mem-desc" placeholder="Short description (optional)" />
            <button type="submit" class="primary-btn small">Add</button>
          </form>
          <div class="memories-music-row">
            <div class="muted">Memories Music (Memories Playlist)</div>
            <button class="secondary-btn small" id="btn-play-memories-music">
              Play Memories Music üéß
            </button>
            <button class="secondary-btn small" id="btn-toggle-main-play">
              Play ‚ñ∂
            </button>
          </div>
          <div class="timeline-wrapper">
            <div class="timeline-line"></div>
            <div id="memories-list"></div>
          </div>
        </section>

        <!-- Video Memories -->
        <section id="section-videos" class="section card">
          <div class="card-header">
            <h2>Video Memories üé•</h2>
            <p class="muted">
              Add small video clips with dates and stories. Tap to watch them.
            </p>
          </div>
          <form class="form-inline" id="videos-form">
            <input type="date" id="vid-date" />
            <input type="text" id="vid-url" placeholder="Video path (e.g. /videos/1.mp4)" />
            <input type="text" id="vid-title" placeholder="Title (optional)" />
            <input type="text" id="vid-desc" placeholder="Short description (optional)" />
            <button type="submit" class="primary-btn small">Add</button>
          </form>
          <div class="timeline-wrapper">
            <div class="timeline-line"></div>
            <div id="videos-list"></div>
          </div>
        </section>

        <!-- Dreams vs Reality -->
        <section id="section-dreams" class="section card">
          <div class="card-header">
            <h2>Dreams vs Reality üåô</h2>
            <p class="muted">
              Text inspired from your ‚ÄúSweet Dreams‚Äù PPT. Read it whenever you want.
            </p>
          </div>
          <div id="dreams-container"></div>
        </section>

        <!-- Music Corner -->
        <section id="section-music" class="section card">
          <div class="card-header">
            <h2>Music Corner üéµ</h2>
            <p class="muted">
              Add songs and choose where they can play: general, memories, or slideshow.
            </p>
          </div>
          <form class="form" id="music-form">
            <label class="form-field">
              <span>Song title</span>
              <input type="text" id="song-title" placeholder="Song name" />
            </label>
            <label class="form-field">
              <span>Artist (optional)</span>
              <input type="text" id="song-artist" placeholder="Artist" />
            </label>
            <label class="form-field">
              <span>Audio path</span>
              <input type="text" id="song-url" placeholder="/music/song.mp3" />
            </label>
            <div class="form-field">
              <span>Use in:</span>
              <label>
                <input type="checkbox" id="song-use-mem" /> Memories Playlist
              </label>
              <label>
                <input type="checkbox" id="song-use-slide" /> Slideshow Playlist
              </label>
            </div>
            <button type="submit" class="primary-btn">Add Song üéß</button>
          </form>

          <div class="music-playlists">
            <button class="secondary-btn small" id="btn-play-main">
              Play Main Playlist
            </button>
            <button class="secondary-btn small" id="btn-play-mem">
              Play Memories Playlist
            </button>
            <button class="secondary-btn small" id="btn-play-slide">
              Play Slideshow Playlist
            </button>
            <button class="secondary-btn small" id="btn-toggle-play">
              Play ‚ñ∂
            </button>
            <button class="secondary-btn small" id="btn-prev-song">‚¨Ö</button>
            <button class="secondary-btn small" id="btn-next-song">‚û°</button>
          </div>

          <div class="songs-list" id="songs-list"></div>
        </section>

        <!-- Work To Do -->
        <section id="section-tasks" class="section card">
          <div class="card-header">
            <h2>Work To Do ‚úÖ</h2>
            <p class="muted">
              Add your work with a deadline. Check this list often ‚Äì like your gentle reminder.
            </p>
          </div>
          <form class="form-inline" id="tasks-form">
            <input type="text" id="task-text" placeholder="What is the work?" />
            <input type="date" id="task-deadline" />
            <button type="submit" class="primary-btn small">Add</button>
          </form>
          <div class="todos-grid" id="tasks-list"></div>
        </section>

        <!-- Diary -->
        <section id="section-diary" class="section card">
          <div class="card-header">
            <h2>Diary üíå</h2>
            <p class="muted">
              Your safe space. Write or record anything you feel. Everything stays only here.
            </p>
          </div>

          <h3>Write Diary üìù</h3>
          <form class="form" id="diary-form">
            <label class="form-field">
              <span>Title (optional)</span>
              <input type="text" id="diary-title" placeholder="Today I feel..." />
            </label>
            <label class="form-field">
              <span>Your thoughts</span>
              <textarea id="diary-content" rows="3" placeholder="Share anything you want..."></textarea>
            </label>
            <button type="submit" class="primary-btn">Save Diary Entry</button>
          </form>

          <div class="diary-list" id="diary-list"></div>

          <h3 style="margin-top: 14px;">Voice Diary üéô</h3>
          <p class="muted">
            For now, add a path to an audio file (like /audio/note1.mp3). Later you can upgrade to real recording.
          </p>
          <form class="form" id="voice-form">
            <label class="form-field">
              <span>Title (optional)</span>
              <input type="text" id="voice-title" placeholder="Voice note title" />
            </label>
            <label class="form-field">
              <span>Audio path</span>
              <input type="text" id="voice-url" placeholder="/audio/voice-note.mp3" />
            </label>
            <button type="submit" class="primary-btn">Save Voice Note</button>
          </form>

          <div class="diary-list" id="voice-list"></div>

          <h3 style="margin-top: 16px;">Special Letter üíå</h3>
          <div class="letter-card" id="letter-display"></div>
        </section>

        <!-- Settings -->
        <section id="section-settings" class="section card">
          <div class="card-header">
            <h2>Settings ‚öôÔ∏è</h2>
            <p class="muted">
              Change your name, theme, and reset the secret password for the hidden area.
            </p>
          </div>

          <h3>Profile</h3>
          <form class="form" id="profile-form">
            <label class="form-field">
              <span>Name</span>
              <input type="text" id="profile-name" placeholder="Your name" />
            </label>
            <p class="muted">
              Birthday is fixed to 09-12-2006 and used only for age & life counter.
            </p>
            <button type="submit" class="primary-btn">Save Profile</button>
          </form>

          <h3 style="margin-top: 12px;">Theme</h3>
          <form class="form" id="theme-form">
            <label class="form-field">
              <span>Theme based on time of day</span>
              <label>
                <input type="checkbox" id="theme-auto" checked /> Use automatic theme
              </label>
            </label>
            <label class="form-field">
              <span>Manual theme</span>
              <select id="theme-manual">
                <option value="morning">Morning Sky</option>
                <option value="day">Bright Pink</option>
                <option value="sunset">Sunset</option>
                <option value="evening">Purple Dream</option>
                <option value="night">Midnight</option>
              </select>
            </label>
            <button type="submit" class="primary-btn">Save Theme</button>
          </form>

          <h3 style="margin-top: 12px;">Reset Hidden Area Password üîí</h3>
          <form class="form" id="password-form">
            <label class="form-field">
              <span>Current password</span>
              <input type="password" id="pwd-current" />
            </label>
            <label class="form-field">
              <span>New password</span>
              <input type="password" id="pwd-new" />
            </label>
            <label class="form-field">
              <span>Confirm new password</span>
              <input type="password" id="pwd-confirm" />
            </label>
            <p class="muted" id="pwd-message"></p>
            <button type="submit" class="primary-btn">Reset Password</button>
            <p class="muted">
              Default password is <strong>bakkaa</strong>.
            </p>
          </form>
        </section>

        <!-- Secret -->
        <section id="section-secret" class="section card">
          <div id="secret-locked">
            <h2>You üîí</h2>
            <p class="muted">
              This space is only for you. Enter your secret password to open hidden
              memories and edit the letter.
            </p>
            <form class="form" id="secret-login-form">
              <label class="form-field">
                <span>Password</span>
                <input type="password" id="secret-password-input" />
              </label>
              <p class="muted" id="secret-error"></p>
              <button type="submit" class="primary-btn">Unlock</button>
            </form>
          </div>

          <div id="secret-unlocked" style="display:none;">
            <h2>Hidden Space üîê</h2>
            <p class="muted">
              Only you can see this area. Hidden photos, videos and the letter live here.
            </p>

            <h3 style="margin-top:10px;">Hidden Photos</h3>
            <form class="form-inline" id="hidden-photos-form">
              <input type="date" id="h-date" />
              <input type="text" id="h-image" placeholder="Image path" />
              <input type="text" id="h-title" placeholder="Title (optional)" />
              <input type="text" id="h-desc" placeholder="Short description (optional)" />
              <button type="submit" class="primary-btn small">Add</button>
            </form>
            <div class="hidden-grid" id="hidden-photos-list"></div>

            <h3 style="margin-top:10px;">Hidden Videos</h3>
            <form class="form-inline" id="hidden-videos-form">
              <input type="date" id="hv-date" />
              <input type="text" id="hv-url" placeholder="Video path" />
              <input type="text" id="hv-title" placeholder="Title (optional)" />
              <input type="text" id="hv-desc" placeholder="Short description (optional)" />
              <button type="submit" class="primary-btn small">Add</button>
            </form>
            <div class="hidden-grid" id="hidden-videos-list"></div>

            <h3 style="margin-top:12px;">Edit Special Letter üíå</h3>
            <p class="muted">
              This letter appears in the Diary tab for her to read. Only you can edit it here.
            </p>
            <textarea id="letter-editor" class="letter-editor" rows="8"></textarea>
            <button id="save-letter-btn" class="primary-btn" style="margin-top:6px;">Save Letter</button>
          </div>
        </section>
      </main>

      <footer class="player-bar">
        <div class="player-info">
          <div class="player-title" id="player-title">No song playing</div>
          <div class="player-artist" id="player-artist"></div>
          <div class="player-tag" id="player-tag">Playlist: -</div>
        </div>
        <div class="player-controls">
          <button class="icon-btn" id="bar-prev">‚¨Ö</button>
          <button class="icon-btn" id="bar-toggle">‚ñ∂</button>
          <button class="icon-btn" id="bar-next">‚û°</button>
        </div>
        <audio id="global-audio" style="display:none;"></audio>
      </footer>
    </div>
  </div>

  <!-- Birthday overlay -->
  <div class="birthday-overlay" id="birthday-overlay" style="display:none;">
    <div class="birthday-card">
      <h2 id="birthday-title">Welcome! üéÇ</h2>
      <p id="birthday-text-1">Tap to blow out your 19 candles and make a wish.</p>
      <div class="cake-wrapper">
        <div class="cake-candles" id="birthday-candles"></div>
        <div class="cake-body">
          <div class="cake-layer cake-layer-top"></div>
          <div class="cake-layer cake-layer-middle"></div>
          <div class="cake-layer cake-layer-bottom">
            <div class="cake-slice" id="cake-slice" style="display:none;"></div>
          </div>
        </div>
        <div class="cake-plate"></div>
      </div>
      <button id="birthday-main-btn" class="primary-btn" style="margin-top:8px;">
        Blow out candles üéà
      </button>
    </div>
  </div>

  <script>
    // --------- Constants and helpers ---------

    const DOB_FIXED = "2006-12-09";

    function todayDateStr() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    function calculateAge(dobStr) {
      const dob = new Date(dobStr);
      if (isNaN(dob.getTime())) return null;
      const today = new Date();
      let age = today.getFullYear() - dob.getFullYear();
      const m = today.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
      return age;
    }

    function diffFromDob(dobStr) {
      const dob = new Date(dobStr);
      if (isNaN(dob.getTime())) return null;
      const now = new Date();
      let years = now.getFullYear() - dob.getFullYear();
      let months = now.getMonth() - dob.getMonth();
      let days = now.getDate() - dob.getDate();

      if (days < 0) {
        months--;
        const lastMonth = new Date(now.getFullYear(), now.getMonth(), 0);
        days += lastMonth.getDate();
      }
      if (months < 0) {
        years--;
        months += 12;
      }
      return { years, months, days };
    }

    function greetingByTime() {
      const h = new Date().getHours();
      if (h < 12) return "Good morning";
      if (h < 16) return "Good afternoon";
      if (h < 20) return "Good evening";
      return "Good night";
    }

    function getTimeThemeName() {
      const h = new Date().getHours();
      if (h >= 4 && h < 11) return "morning";
      if (h >= 11 && h < 16) return "day";
      if (h >= 16 && h < 19) return "sunset";
      if (h >= 19 && h < 23) return "evening";
      return "night";
    }

    function loadLocal(key, defaultValue) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return defaultValue;
        return JSON.parse(raw);
      } catch {
        return defaultValue;
      }
    }

    function saveLocal(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch {}
    }

    // --------- Storage keys & default data ---------

    const STORAGE = {
      profile: "hw_profile_web",
      meta: "hw_meta_web",
      memories: "hw_memories_web",
      videos: "hw_videos_web",
      hiddenMemories: "hw_hidden_memories_web",
      hiddenVideos: "hw_hidden_videos_web",
      dreams: "hw_dreams_web",
      songs: "hw_songs_web",
      tasks: "hw_tasks_web",
      diary: "hw_diary_web",
      voiceDiary: "hw_voice_diary_web",
      letter: "hw_letter_web",
      settings: "hw_settings_web",
      password: "hw_password_web"
    };

    const DEFAULT_PROFILE = {
      name: "Bakka",
      dob: DOB_FIXED
    };

    const DEFAULT_DREAMS = [
      {
        id: 1,
        dream:
          "To change my life like in my sweet dreams ‚Äì to see my life before and after I make a real change, and live my ideal daily routine in reality, not only in dreams.",
        reality:
          "Right now reality hits different, but I am giving myself another chance. I am ending my lazy life here and saying goodbye to laziness. I promise to be the best and do the best for myself, never take time for granted, and stop giving excuses. Once I start, I will never stop, so before I start I think carefully and start with full confidence.",
        targetDate: "",
        isCompleted: true
      }
    ];

    const DEFAULT_LETTER = `Bakka‚Ä¶

I read your letter again and again.
Every line you wrote touched me deeply.
I never knew someone could care for me the way you do‚Ä¶
and after reading your words, I understood how real and pure your heart is.

You said I am important to you‚Ä¶
but Bakka, you are just as important to me ‚Äî maybe even more.
You said you will stay with me no matter what‚Ä¶
and I want you to know that I will also stay with you‚Ä¶ always.

I know sometimes I hurt you without meaning to.
Sometimes I didn‚Äôt understand your feelings properly.
But your letter opened my eyes‚Ä¶
it showed me how much you love, how much you feel,
and how strong your heart actually is.

Thank you for trusting me.
Thank you for sharing your feelings with me.
Thank you for making me feel special in a way no one ever has.

You told me to share everything with you‚Ä¶
and I promise I will.
I won‚Äôt hide my feelings anymore.
If I‚Äôm sad, I‚Äôll tell you.
If something hurts me, I‚Äôll tell you.
If I feel alone, I‚Äôll come to you.
Just like how you want to be there for me‚Ä¶
I also want to be there for you, Bakka.

If your heart is heavy, I‚Äôm here.
If you‚Äôre scared, I‚Äôm here.
If you‚Äôre angry, I‚Äôm here.
If you want to cry, I‚Äôm here.
If you‚Äôre happy, I want to smile with you.
And if life breaks you, I‚Äôll be the one holding you together.

You are not too much.
You are not difficult.
Your feelings are not wrong.
Your love is not wrong.
You are real.
And that‚Äôs why I value you more than you know.

You said you won‚Äôt leave me no matter what‚Ä¶
and I want you to know that I won‚Äôt leave you either.
Not now, not later, not ever.

Thank you for writing that letter to me, Bakka.
This is my reply ‚Äî from my heart directly to yours.

Always with you,
Your Chintu ‚ù§Ô∏è`;

    const DEFAULT_SETTINGS = {
      autoTheme: true,
      manualTheme: "day"
    };

    // --------- Global state (in JS, not React) ---------

    let profile = loadLocal(STORAGE.profile, DEFAULT_PROFILE);
    let meta = loadLocal(STORAGE.meta, { hasOpenedBefore: false });
    let settings = loadLocal(STORAGE.settings, DEFAULT_SETTINGS);
    let memories = loadLocal(STORAGE.memories, []);
    let videos = loadLocal(STORAGE.videos, []);
    let hiddenMemories = loadLocal(STORAGE.hiddenMemories, []);
    let hiddenVideos = loadLocal(STORAGE.hiddenVideos, []);
    let dreams = loadLocal(STORAGE.dreams, DEFAULT_DREAMS);
    let songs = loadLocal(STORAGE.songs, []);
    let tasks = loadLocal(STORAGE.tasks, []);
    let diaryEntries = loadLocal(STORAGE.diary, []);
    let voiceDiaryEntries = loadLocal(STORAGE.voiceDiary, []);
    let letterText = loadLocal(STORAGE.letter, DEFAULT_LETTER);
    let secretPassword = loadLocal(STORAGE.password, "bakkaa");

    const playerState = {
      currentSongId: null,
      playlistType: "main", // main | memories | slideshow
      queue: [],
      queueIndex: 0,
      isPlaying: false
    };

    let slideshowIndex = 0;
    let slideshowShuffle = false;

    // --------- DOM references ---------

    const themeWrapper = document.getElementById("theme-wrapper");
    const appTitle = document.getElementById("app-title");
    const appSubtitle = document.getElementById("app-subtitle");
    const lifeCounter = document.getElementById("life-counter");
    const avatarInitials = document.getElementById("avatar-initials");

    const navTabs = document.querySelectorAll(".nav-tab");
    const sections = {
      home: document.getElementById("section-home"),
      memories: document.getElementById("section-memories"),
      videos: document.getElementById("section-videos"),
      dreams: document.getElementById("section-dreams"),
      music: document.getElementById("section-music"),
      tasks: document.getElementById("section-tasks"),
      diary: document.getElementById("section-diary"),
      settings: document.getElementById("section-settings"),
      secret: document.getElementById("section-secret")
    };

    const homeSlideshowContainer = document.getElementById("home-slideshow-container");
    const homeSlideshowControls = document.getElementById("home-slideshow-controls");

    const memoriesForm = document.getElementById("memories-form");
    const memDateInput = document.getElementById("mem-date");
    const memImageInput = document.getElementById("mem-image");
    const memTitleInput = document.getElementById("mem-title");
    const memDescInput = document.getElementById("mem-desc");
    const memoriesList = document.getElementById("memories-list");

    const videosForm = document.getElementById("videos-form");
    const vidDateInput = document.getElementById("vid-date");
    const vidUrlInput = document.getElementById("vid-url");
    const vidTitleInput = document.getElementById("vid-title");
    const vidDescInput = document.getElementById("vid-desc");
    const videosList = document.getElementById("videos-list");

    const dreamsContainer = document.getElementById("dreams-container");

    const musicForm = document.getElementById("music-form");
    const songTitleInput = document.getElementById("song-title");
    const songArtistInput = document.getElementById("song-artist");
    const songUrlInput = document.getElementById("song-url");
    const songUseMemInput = document.getElementById("song-use-mem");
    const songUseSlideInput = document.getElementById("song-use-slide");
    const songsList = document.getElementById("songs-list");

    const btnPlayMain = document.getElementById("btn-play-main");
    const btnPlayMem = document.getElementById("btn-play-mem");
    const btnPlaySlide = document.getElementById("btn-play-slide");
    const btnTogglePlay = document.getElementById("btn-toggle-play");
    const btnPrevSong = document.getElementById("btn-prev-song");
    const btnNextSong = document.getElementById("btn-next-song");

    const btnPlayMemoriesMusic = document.getElementById("btn-play-memories-music");
    const btnToggleMainPlay = document.getElementById("btn-toggle-main-play");

    const tasksForm = document.getElementById("tasks-form");
    const taskTextInput = document.getElementById("task-text");
    const taskDeadlineInput = document.getElementById("task-deadline");
    const tasksList = document.getElementById("tasks-list");

    const diaryForm = document.getElementById("diary-form");
    const diaryTitleInput = document.getElementById("diary-title");
    const diaryContentInput = document.getElementById("diary-content");
    const diaryList = document.getElementById("diary-list");

    const voiceForm = document.getElementById("voice-form");
    const voiceTitleInput = document.getElementById("voice-title");
    const voiceUrlInput = document.getElementById("voice-url");
    const voiceList = document.getElementById("voice-list");

    const letterDisplay = document.getElementById("letter-display");

    const profileForm = document.getElementById("profile-form");
    const profileNameInput = document.getElementById("profile-name");

    const themeForm = document.getElementById("theme-form");
    const themeAutoInput = document.getElementById("theme-auto");
    const themeManualSelect = document.getElementById("theme-manual");

    const passwordForm = document.getElementById("password-form");
    const pwdCurrentInput = document.getElementById("pwd-current");
    const pwdNewInput = document.getElementById("pwd-new");
    const pwdConfirmInput = document.getElementById("pwd-confirm");
    const pwdMessage = document.getElementById("pwd-message");

    const secretLocked = document.getElementById("secret-locked");
    const secretUnlocked = document.getElementById("secret-unlocked");
    const secretLoginForm = document.getElementById("secret-login-form");
    const secretPwdInput = document.getElementById("secret-password-input");
    const secretError = document.getElementById("secret-error");

    const hiddenPhotosForm = document.getElementById("hidden-photos-form");
    const hDateInput = document.getElementById("h-date");
    const hImageInput = document.getElementById("h-image");
    const hTitleInput = document.getElementById("h-title");
    const hDescInput = document.getElementById("h-desc");
    const hiddenPhotosList = document.getElementById("hidden-photos-list");

    const hiddenVideosForm = document.getElementById("hidden-videos-form");
    const hvDateInput = document.getElementById("hv-date");
    const hvUrlInput = document.getElementById("hv-url");
    const hvTitleInput = document.getElementById("hv-title");
    const hvDescInput = document.getElementById("hv-desc");
    const hiddenVideosList = document.getElementById("hidden-videos-list");

    const letterEditor = document.getElementById("letter-editor");
    const saveLetterBtn = document.getElementById("save-letter-btn");

    const playerTitle = document.getElementById("player-title");
    const playerArtist = document.getElementById("player-artist");
    const playerTag = document.getElementById("player-tag");
    const barPrev = document.getElementById("bar-prev");
    const barToggle = document.getElementById("bar-toggle");
    const barNext = document.getElementById("bar-next");
    const globalAudio = document.getElementById("global-audio");

    const birthdayOverlay = document.getElementById("birthday-overlay");
    const birthdayTitle = document.getElementById("birthday-title");
    const birthdayText1 = document.getElementById("birthday-text-1");
    const birthdayMainBtn = document.getElementById("birthday-main-btn");
    const cakeSlice = document.getElementById("cake-slice");
    const birthdayCandles = document.getElementById("birthday-candles");

    // --------- Tabs ---------

    function showTab(id) {
      for (const tab of navTabs) {
        tab.classList.toggle("nav-tab-active", tab.dataset.tab === id);
      }
      Object.keys(sections).forEach((key) => {
        sections[key].classList.toggle("active", key === id);
      });
    }

    navTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const id = tab.dataset.tab;
        showTab(id);
      });
    });

    // --------- Header ---------

    function updateHeader() {
      const name = profile.name || "Bakka";
      appTitle.textContent = `${name}'s World üíñ`;
      const greet = greetingByTime();
      const age = calculateAge(DOB_FIXED);
      appSubtitle.textContent = `${greet}, ${name}!${
        age != null ? " (" + age + " years old)" : ""
      }`;

      const span = diffFromDob(DOB_FIXED);
      if (span) {
        lifeCounter.textContent = `With you for ${span.years} years, ${span.months} months and ${span.days} days ‚ú®`;
      } else {
        lifeCounter.textContent = "";
      }

      const initials = name
        .split(" ")
        .filter(Boolean)
        .map((w) => w[0])
        .join("")
        .slice(0, 2);
      avatarInitials.textContent = initials || "B";
    }

    // --------- Theme ---------

    function updateTheme() {
      const themeName = settings.autoTheme
        ? getTimeThemeName()
        : settings.manualTheme || "day";
      themeWrapper.className = "theme-" + themeName;
    }

    setInterval(() => {
      if (settings.autoTheme) updateTheme();
    }, 5 * 60 * 1000);

    // --------- Home slideshow ---------

    function getSlideshowMemories() {
      return memories.filter((m) => m.imageUrl);
    }

    function renderHomeSlideshow() {
      const slideshowMemories = getSlideshowMemories();
      homeSlideshowContainer.innerHTML = "";
      homeSlideshowControls.innerHTML = "";

      if (!slideshowMemories.length) {
        homeSlideshowContainer.innerHTML =
          '<p class="muted">Add some photo memories first to see them here as a slideshow.</p>';
        return;
      }

      if (slideshowIndex >= slideshowMemories.length) slideshowIndex = 0;
      const slide = slideshowMemories[slideshowIndex];

      const container = document.createElement("div");
      container.className = "slideshow-inner";
      container.innerHTML = `
        <div class="slideshow-image-wrap">
          <img src="${slide.imageUrl}" class="slideshow-image" alt="memory" />
          <div class="slideshow-date">
            ${new Date(slide.date).toLocaleDateString()}
          </div>
          ${
            slide.description
              ? `<div class="slideshow-desc">${slide.description}</div>`
              : ""
          }
        </div>
      `;
      homeSlideshowContainer.appendChild(container);

      const controlsDiv = document.createElement("div");
      controlsDiv.className = "slideshow-controls";
      controlsDiv.innerHTML = `
        <button class="secondary-btn small" id="slide-prev">‚¨Ö Prev</button>
        <button class="secondary-btn small ${
          slideshowShuffle ? "btn-active" : ""
        }" id="slide-shuffle">üîÄ Shuffle ${
        slideshowShuffle ? "On" : "Off"
      }</button>
        <button class="secondary-btn small" id="slide-next">Next ‚û°</button>
      `;
      homeSlideshowControls.appendChild(controlsDiv);

      document.getElementById("slide-prev").onclick = () => {
        const len = getSlideshowMemories().length;
        slideshowIndex = (slideshowIndex - 1 + len) % len;
        renderHomeSlideshow();
      };
      document.getElementById("slide-next").onclick = () => {
        const len = getSlideshowMemories().length;
        slideshowIndex = (slideshowIndex + 1) % len;
        renderHomeSlideshow();
      };
      document.getElementById("slide-shuffle").onclick = () => {
        slideshowShuffle = !slideshowShuffle;
        renderHomeSlideshow();
      };
    }

    setInterval(() => {
      const slides = getSlideshowMemories();
      if (!slides.length) return;
      if (slideshowShuffle) {
        slideshowIndex = Math.floor(Math.random() * slides.length);
      } else {
        slideshowIndex = (slideshowIndex + 1) % slides.length;
      }
      renderHomeSlideshow();
    }, 5000);

    // --------- Memories & videos ---------

    function renderMemories() {
      memoriesList.innerHTML = "";
      const sorted = [...memories].sort(
        (a, b) => new Date(a.date) - new Date(b.date)
      );
      if (!sorted.length) {
        memoriesList.innerHTML =
          '<p class="muted">No memories yet. Add your first one ‚ú®</p>';
        return;
      }

      sorted.forEach((m, idx) => {
        const side = idx % 2 === 0 ? "left" : "right";
        const item = document.createElement("div");
        item.className = "zig-item " + side;

        const node = document.createElement("div");
        node.className = "zig-node";

        const card = document.createElement("div");
        card.className = "zig-card";
        card.innerHTML = `
          <div class="zig-date">${new Date(m.date).toLocaleDateString()}</div>
          ${
            m.imageUrl
              ? `<img src="${m.imageUrl}" class="zig-thumb" alt="memory" />`
              : ""
          }
          ${m.title ? `<div class="zig-title">${m.title}</div>` : ""}
          ${
            m.description ? `<div class="zig-desc">${m.description}</div>` : ""
          }
          <button class="link-btn danger">Delete</button>
        `;

        card.querySelector("button").onclick = (e) => {
          e.stopPropagation();
          memories = memories.filter((x) => x.id !== m.id);
          saveLocal(STORAGE.memories, memories);
          renderMemories();
          renderHomeSlideshow();
        };

        card.onclick = () => openMemoryModal(m, "image");
        item.appendChild(node);
        item.appendChild(card);
        memoriesList.appendChild(item);
      });
    }

    function renderVideos() {
      videosList.innerHTML = "";
      const sorted = [...videos].sort(
        (a, b) => new Date(a.date) - new Date(b.date)
      );
      if (!sorted.length) {
        videosList.innerHTML =
          '<p class="muted">No video memories yet.</p>';
        return;
      }
      sorted.forEach((v, idx) => {
        const side = idx % 2 === 0 ? "left" : "right";
        const item = document.createElement("div");
        item.className = "zig-item " + side;

        const node = document.createElement("div");
        node.className = "zig-node";

        const card = document.createElement("div");
        card.className = "zig-card";
        card.innerHTML = `
          <div class="zig-date">${new Date(v.date).toLocaleDateString()}</div>
          ${v.title ? `<div class="zig-title">${v.title}</div>` : ""}
          ${
            v.description ? `<div class="zig-desc">${v.description}</div>` : ""
          }
          <button class="link-btn danger">Delete</button>
        `;

        card.querySelector("button").onclick = (e) => {
          e.stopPropagation();
          videos = videos.filter((x) => x.id !== v.id);
          saveLocal(STORAGE.videos, videos);
          renderVideos();
        };

        card.onclick = () => openMemoryModal(v, "video");
        item.appendChild(node);
        item.appendChild(card);
        videosList.appendChild(item);
      });
    }

    function openMemoryModal(item, type) {
      const modal = document.createElement("div");
      modal.className = "memory-modal";
      const inner = document.createElement("div");
      inner.className = "memory-modal-inner";

      inner.innerHTML = `
        <h3>${item.title || (type === "image" ? "Memory" : "Video memory")}</h3>
        <p class="muted">${new Date(item.date).toLocaleDateString()}</p>
      `;

      if (type === "image" && item.imageUrl) {
        const img = document.createElement("img");
        img.src = item.imageUrl;
        img.className = "modal-image";
        inner.appendChild(img);
      } else if (type === "video" && item.videoUrl) {
        const vid = document.createElement("video");
        vid.src = item.videoUrl;
        vid.className = "modal-video";
        vid.controls = true;
        inner.appendChild(vid);
      }

      if (item.description) {
        const p = document.createElement("p");
        p.textContent = item.description;
        inner.appendChild(p);
      }

      const closeBtn = document.createElement("button");
      closeBtn.textContent = "Close";
      closeBtn.className = "secondary-btn";
      closeBtn.onclick = () => document.body.removeChild(modal);
      inner.appendChild(closeBtn);

      modal.onclick = () => document.body.removeChild(modal);
      inner.onclick = (e) => e.stopPropagation();

      modal.appendChild(inner);
      document.body.appendChild(modal);
    }

    // --------- Dreams vs reality ---------

    function renderDreams() {
      dreamsContainer.innerHTML = "";
      if (!dreams.length) {
        dreamsContainer.innerHTML =
          '<p class="muted">No content yet.</p>';
        return;
      }
      dreams.forEach((g) => {
        const div = document.createElement("div");
        div.className = "goal-item completed";
        div.style.marginBottom = "8px";
        div.innerHTML = `
          <div class="goal-title" style="font-weight:600; font-size:0.9rem; margin-bottom:3px;">
            ${g.dream}
          </div>
          ${
            g.reality
              ? `<div class="goal-desc" style="font-size:0.85rem; color:var(--text-muted);">
                   <strong>Reality:</strong> ${g.reality}
                 </div>`
              : ""
          }
        `;
        dreamsContainer.appendChild(div);
      });
    }

    // --------- Music / audio ---------

    function getPlaylist(type) {
      if (type === "memories") {
        return songs.filter((s) => s.useInMemories);
      }
      if (type === "slideshow") {
        return songs.filter((s) => s.useInSlideshow);
      }
      return songs;
    }

    function setPlayerFromQueue() {
      const list = getPlaylist(playerState.playlistType);
      if (!list.length || !playerState.queue.length) {
        playerState.currentSongId = null;
        playerState.isPlaying = false;
        globalAudio.pause();
        playerTitle.textContent = "No song playing";
        playerArtist.textContent = "";
        playerTag.textContent = "Playlist: -";
        barToggle.textContent = "‚ñ∂";
        return;
      }
      const id = playerState.queue[playerState.queueIndex];
      const song = list.find((s) => s.id === id);
      if (!song) return;
      playerState.currentSongId = id;
      globalAudio.src = song.url || "";
      playerTitle.textContent = song.title || "Song";
      playerArtist.textContent = song.artist || "";
      playerTag.textContent = "Playlist: " + playerState.playlistType;
      if (playerState.isPlaying && song.url) {
        globalAudio
          .play()
          .catch(() => {});
        barToggle.textContent = "‚è∏";
      } else {
        globalAudio.pause();
        barToggle.textContent = "‚ñ∂";
      }
    }

    function startPlaylist(type) {
      const list = getPlaylist(type);
      if (!list.length) return;
      playerState.playlistType = type;
      playerState.queue = list.map((s) => s.id);
      playerState.queueIndex = 0;
      playerState.isPlaying = true;
      setPlayerFromQueue();
      btnTogglePlay.textContent = "Pause ‚è∏";
    }

    function togglePlayPause() {
      if (!playerState.currentSongId) {
        if (songs.length) {
          startPlaylist("main");
        }
        return;
      }
      playerState.isPlaying = !playerState.isPlaying;
      setPlayerFromQueue();
      btnTogglePlay.textContent = playerState.isPlaying ? "Pause ‚è∏" : "Play ‚ñ∂";
    }

    function playNextSong() {
      if (!playerState.queue.length) return;
      playerState.queueIndex =
        (playerState.queueIndex + 1) % playerState.queue.length;
      playerState.isPlaying = true;
      setPlayerFromQueue();
    }

    function playPrevSong() {
      if (!playerState.queue.length) return;
      playerState.queueIndex =
        (playerState.queueIndex - 1 + playerState.queue.length) %
        playerState.queue.length;
      playerState.isPlaying = true;
      setPlayerFromQueue();
    }

    globalAudio.addEventListener("ended", playNextSong);

    function renderSongs() {
      songsList.innerHTML = "";
      if (!songs.length) {
        songsList.innerHTML =
          '<p class="muted">No songs yet. Add some üíó</p>';
        return;
      }
      songs.forEach((s) => {
        const item = document.createElement("div");
        item.className = "song-item";
        const tags = [];
        if (s.useInMemories) tags.push("<span>Memories</span>");
        if (s.useInSlideshow) tags.push("<span>Slideshow</span>");

        item.innerHTML = `
          <div>
            <div class="song-title">${s.title}</div>
            ${
              s.artist
                ? `<div class="song-artist">${s.artist}</div>`
                : ""
            }
            <div class="song-tags">${tags.join(" ")}</div>
          </div>
          <button class="link-btn danger">Remove</button>
        `;

        item.querySelector("button").onclick = () => {
          songs = songs.filter((x) => x.id !== s.id);
          saveLocal(STORAGE.songs, songs);
          renderSongs();
          if (playerState.currentSongId === s.id) {
            playerState.currentSongId = null;
            setPlayerFromQueue();
          }
        };

        songsList.appendChild(item);
      });
    }

    // --------- Tasks ---------

    function renderTasks() {
      tasksList.innerHTML = "";
      if (!tasks.length) {
        tasksList.innerHTML =
          '<p class="muted">No work yet. Start with one small task ‚ú®</p>';
        return;
      }

      const today = todayDateStr();

      function statusOf(t) {
        if (t.isCompleted) return "Completed";
        if (t.deadline < today) return "Past deadline";
        if (t.deadline === today) return "Due today";
        return "Upcoming";
      }

      tasks.forEach((t) => {
        const card = document.createElement("div");
        card.className = "todo-card" + (t.isCompleted ? " todo-card-done" : "");
        card.innerHTML = `
          <div class="todo-top-row">
            <label>
              <input type="checkbox" ${t.isCompleted ? "checked" : ""} /> Done
            </label>
            <button class="link-btn danger">‚úï</button>
          </div>
          <div class="todo-text">${t.text}</div>
          <div class="todo-date">
            Deadline: ${new Date(t.deadline).toLocaleDateString()} ‚Ä¢ ${statusOf(
          t
        )}
          </div>
        `;

        const checkbox = card.querySelector("input[type='checkbox']");
        const delBtn = card.querySelector(".link-btn.danger");

        checkbox.onchange = () => {
          t.isCompleted = checkbox.checked;
          saveLocal(STORAGE.tasks, tasks);
          renderTasks();
        };
        delBtn.onclick = () => {
          tasks = tasks.filter((x) => x.id !== t.id);
          saveLocal(STORAGE.tasks, tasks);
          renderTasks();
        };

        tasksList.appendChild(card);
      });
    }

    // --------- Diary & voice ---------

    function renderDiary() {
      diaryList.innerHTML = "";
      if (!diaryEntries.length) return;
      diaryEntries.forEach((d) => {
        const card = document.createElement("div");
        card.className = "diary-card";
        card.innerHTML = `
          <div class="diary-header">
            <div>
              <div class="diary-title">${d.title || "Diary Entry"}</div>
              <div class="diary-date">${new Date(
                d.date
              ).toLocaleDateString()}</div>
            </div>
            <button class="link-btn danger">Delete</button>
          </div>
          <div class="diary-content">${d.content}</div>
        `;
        card.querySelector("button").onclick = () => {
          diaryEntries = diaryEntries.filter((x) => x.id !== d.id);
          saveLocal(STORAGE.diary, diaryEntries);
          renderDiary();
        };
        diaryList.appendChild(card);
      });
    }

    function renderVoiceDiary() {
      voiceList.innerHTML = "";
      if (!voiceDiaryEntries.length) return;
      voiceDiaryEntries.forEach((v) => {
        const card = document.createElement("div");
        card.className = "diary-card";
        card.innerHTML = `
          <div class="diary-header">
            <div>
              <div class="diary-title">${v.title || "Voice note"}</div>
              <div class="diary-date">${new Date(
                v.date
              ).toLocaleDateString()}</div>
            </div>
            <button class="link-btn danger">Delete</button>
          </div>
        `;
        const audio = document.createElement("audio");
        audio.controls = true;
        audio.src = v.url;
        audio.style.width = "100%";
        card.appendChild(audio);
        card.querySelector("button").onclick = () => {
          voiceDiaryEntries = voiceDiaryEntries.filter((x) => x.id !== v.id);
          saveLocal(STORAGE.voiceDiary, voiceDiaryEntries);
          renderVoiceDiary();
        };
        voiceList.appendChild(card);
      });
    }

    function renderLetterDisplay() {
      letterDisplay.innerHTML = "";
      letterText.split("\n").forEach((line) => {
        const p = document.createElement("p");
        p.className = "letter-line";
        p.textContent = line;
        letterDisplay.appendChild(p);
      });
    }

    // --------- Settings ---------

    function renderSettings() {
      profileNameInput.value = profile.name || "Bakka";
      themeAutoInput.checked = settings.autoTheme;
      themeManualSelect.value = settings.manualTheme || "day";
    }

    // --------- Secret / hidden ---------

    function renderHiddenPhotos() {
      hiddenPhotosList.innerHTML = "";
      if (!hiddenMemories.length) {
        hiddenPhotosList.innerHTML =
          '<p class="muted">No hidden photos yet.</p>';
        return;
      }
      const sorted = [...hiddenMemories].sort(
        (a, b) => new Date(a.date) - new Date(b.date)
      );
      sorted.forEach((m) => {
        const card = document.createElement("div");
        card.className = "hidden-card";
        card.innerHTML = `
          ${
            m.imageUrl
              ? `<img src="${m.imageUrl}" class="hidden-thumb" alt="hidden" />`
              : ""
          }
          <div class="hidden-title">${m.title || "Hidden"}</div>
          <div class="hidden-date">${new Date(
            m.date
          ).toLocaleDateString()}</div>
          ${
            m.description
              ? `<div class="hidden-desc">${m.description}</div>`
              : ""
          }
          <button class="link-btn danger">Delete</button>
        `;
        card.querySelector("button").onclick = () => {
          hiddenMemories = hiddenMemories.filter((x) => x.id !== m.id);
          saveLocal(STORAGE.hiddenMemories, hiddenMemories);
          renderHiddenPhotos();
        };
        hiddenPhotosList.appendChild(card);
      });
    }

    function renderHiddenVideos() {
      hiddenVideosList.innerHTML = "";
      if (!hiddenVideos.length) {
        hiddenVideosList.innerHTML =
          '<p class="muted">No hidden videos yet.</p>';
        return;
      }
      const sorted = [...hiddenVideos].sort(
        (a, b) => new Date(a.date) - new Date(b.date)
      );
      sorted.forEach((v) => {
        const card = document.createElement("div");
        card.className = "hidden-card";
        card.innerHTML = `
          <div class="hidden-title">${v.title || "Hidden video"}</div>
          <div class="hidden-date">${new Date(
            v.date
          ).toLocaleDateString()}</div>
          ${
            v.description
              ? `<div class="hidden-desc">${v.description}</div>`
              : ""
          }
        `;
        if (v.videoUrl) {
          const vid = document.createElement("video");
          vid.src = v.videoUrl;
          vid.controls = true;
          vid.className = "hidden-video";
          card.appendChild(vid);
        }
        const delBtn = document.createElement("button");
        delBtn.className = "link-btn danger";
        delBtn.textContent = "Delete";
        delBtn.onclick = () => {
          hiddenVideos = hiddenVideos.filter((x) => x.id !== v.id);
          saveLocal(STORAGE.hiddenVideos, hiddenVideos);
          renderHiddenVideos();
        };
        card.appendChild(delBtn);
        hiddenVideosList.appendChild(card);
      });
    }

    // --------- Birthday overlay ---------

    function initBirthdayOverlay() {
      if (meta.hasOpenedBefore) return;
      birthdayOverlay.style.display = "flex";
      birthdayTitle.textContent = `Welcome, ${profile.name || "Beautiful Soul"}! üéÇ`;
      birthdayText1.textContent = "Tap to blow out your 19 candles and make a wish.";

      birthdayCandles.innerHTML = "";
      for (let i = 0; i < 19; i++) {
        const c = document.createElement("div");
        c.className = "candle";
        const flame = document.createElement("div");
        flame.className = "flame";
        c.appendChild(flame);
        birthdayCandles.appendChild(c);
      }

      let step = 1;
      birthdayMainBtn.onclick = () => {
        if (step === 1) {
          // blow candles
          birthdayCandles.querySelectorAll(".flame").forEach((f) => {
            f.style.display = "none";
          });
          birthdayText1.textContent = "Now tap to cut your cake!";
          birthdayMainBtn.textContent = "Cut the cake üç∞";
          step = 2;
        } else if (step === 2) {
          cakeSlice.style.display = "block";
          birthdayText1.textContent =
            "May every little dream in your heart gently turn into your reality. üíó";
          birthdayMainBtn.textContent = "Enter your world üåà";
          birthdayMainBtn.className = "secondary-btn";
          step = 3;
        } else {
          birthdayOverlay.style.display = "none";
          meta.hasOpenedBefore = true;
          saveLocal(STORAGE.meta, meta);
        }
      };
    }

    // --------- Event listeners ---------

    memoriesForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = memDateInput.value || todayDateStr();
      const imageUrl = memImageInput.value.trim();
      if (!imageUrl) return;
      const title = memTitleInput.value.trim();
      const desc = memDescInput.value.trim();
      memories.push({
        id: Date.now(),
        date,
        imageUrl,
        title,
        description: desc
      });
      saveLocal(STORAGE.memories, memories);
      memDateInput.value = todayDateStr();
      memImageInput.value = "";
      memTitleInput.value = "";
      memDescInput.value = "";
      renderMemories();
      renderHomeSlideshow();
    });

    videosForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = vidDateInput.value || todayDateStr();
      const url = vidUrlInput.value.trim();
      if (!url) return;
      const title = vidTitleInput.value.trim();
      const desc = vidDescInput.value.trim();
      videos.push({
        id: Date.now(),
        date,
        videoUrl: url,
        title,
        description: desc
      });
      saveLocal(STORAGE.videos, videos);
      vidDateInput.value = todayDateStr();
      vidUrlInput.value = "";
      vidTitleInput.value = "";
      vidDescInput.value = "";
      renderVideos();
    });

    musicForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = songTitleInput.value.trim();
      const url = songUrlInput.value.trim();
      if (!title || !url) return;
      const artist = songArtistInput.value.trim();
      const useMem = songUseMemInput.checked;
      const useSlide = songUseSlideInput.checked;
      songs.push({
        id: Date.now(),
        title,
        artist,
        url,
        useInMemories: useMem,
        useInSlideshow: useSlide
      });
      saveLocal(STORAGE.songs, songs);
      songTitleInput.value = "";
      songArtistInput.value = "";
      songUrlInput.value = "";
      songUseMemInput.checked = false;
      songUseSlideInput.checked = false;
      renderSongs();
    });

    btnPlayMain.onclick = () => startPlaylist("main");
    btnPlayMem.onclick = () => startPlaylist("memories");
    btnPlaySlide.onclick = () => startPlaylist("slideshow");
    btnTogglePlay.onclick = togglePlayPause;
    btnPrevSong.onclick = playPrevSong;
    btnNextSong.onclick = playNextSong;

    btnPlayMemoriesMusic.onclick = () => startPlaylist("memories");
    btnToggleMainPlay.onclick = togglePlayPause;

    barPrev.onclick = playPrevSong;
    barNext.onclick = playNextSong;
    barToggle.onclick = () => {
      togglePlayPause();
    };

    tasksForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = taskTextInput.value.trim();
      const deadline = taskDeadlineInput.value || todayDateStr();
      if (!text) return;
      tasks.push({
        id: Date.now(),
        text,
        deadline,
        createdDate: todayDateStr(),
        isCompleted: false
      });
      saveLocal(STORAGE.tasks, tasks);
      taskTextInput.value = "";
      taskDeadlineInput.value = todayDateStr();
      renderTasks();
    });

    diaryForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const content = diaryContentInput.value.trim();
      if (!content) return;
      const title = diaryTitleInput.value.trim();
      diaryEntries.unshift({
        id: Date.now(),
        title,
        content,
        date: todayDateStr()
      });
      saveLocal(STORAGE.diary, diaryEntries);
      diaryTitleInput.value = "";
      diaryContentInput.value = "";
      renderDiary();
    });

    voiceForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const url = voiceUrlInput.value.trim();
      if (!url) return;
      const title = voiceTitleInput.value.trim();
      voiceDiaryEntries.unshift({
        id: Date.now(),
        title,
        url,
        date: todayDateStr()
      });
      saveLocal(STORAGE.voiceDiary, voiceDiaryEntries);
      voiceTitleInput.value = "";
      voiceUrlInput.value = "";
      renderVoiceDiary();
    });

    profileForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = profileNameInput.value.trim() || "Bakka";
      profile.name = name;
      saveLocal(STORAGE.profile, profile);
      updateHeader();
    });

    themeForm.addEventListener("submit", (e) => {
      e.preventDefault();
      settings.autoTheme = themeAutoInput.checked;
      settings.manualTheme = themeManualSelect.value;
      saveLocal(STORAGE.settings, settings);
      updateTheme();
    });

    passwordForm.addEventListener("submit", (e) => {
      e.preventDefault();
      pwdMessage.textContent = "";
      pwdMessage.style.color = "";

      const current = pwdCurrentInput.value;
      const next = pwdNewInput.value;
      const confirm = pwdConfirmInput.value;

      if (current !== secretPassword) {
        pwdMessage.textContent = "Incorrect current password.";
        pwdMessage.style.color = "#ff4b6e";
        return;
      }
      if (!next || next !== confirm) {
        pwdMessage.textContent = "New passwords do not match.";
        pwdMessage.style.color = "#ff4b6e";
        return;
      }
      secretPassword = next;
      saveLocal(STORAGE.password, secretPassword);
      pwdMessage.textContent = "Password updated successfully.";
      pwdMessage.style.color = "#2ecc71";
      pwdCurrentInput.value = "";
      pwdNewInput.value = "";
      pwdConfirmInput.value = "";
    });

    secretLoginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const pwd = secretPwdInput.value;
      if (pwd === secretPassword) {
        secretError.textContent = "";
        secretLocked.style.display = "none";
        secretUnlocked.style.display = "block";
        letterEditor.value = letterText;
        renderHiddenPhotos();
        renderHiddenVideos();
      } else {
        secretError.textContent = "Wrong password. This place is only for you.";
      }
    });

    hiddenPhotosForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = hDateInput.value || todayDateStr();
      const imageUrl = hImageInput.value.trim();
      if (!imageUrl) return;
      const title = hTitleInput.value.trim();
      const desc = hDescInput.value.trim();
      hiddenMemories.push({
        id: Date.now(),
        date,
        imageUrl,
        title,
        description: desc
      });
      saveLocal(STORAGE.hiddenMemories, hiddenMemories);
      hDateInput.value = todayDateStr();
      hImageInput.value = "";
      hTitleInput.value = "";
      hDescInput.value = "";
      renderHiddenPhotos();
    });

    hiddenVideosForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = hvDateInput.value || todayDateStr();
      const url = hvUrlInput.value.trim();
      if (!url) return;
      const title = hvTitleInput.value.trim();
      const desc = hvDescInput.value.trim();
      hiddenVideos.push({
        id: Date.now(),
        date,
        videoUrl: url,
        title,
        description: desc
      });
      saveLocal(STORAGE.hiddenVideos, hiddenVideos);
      hvDateInput.value = todayDateStr();
      hvUrlInput.value = "";
      hvTitleInput.value = "";
      hvDescInput.value = "";
      renderHiddenVideos();
    });

    saveLetterBtn.addEventListener("click", () => {
      letterText = letterEditor.value;
      saveLocal(STORAGE.letter, letterText);
      renderLetterDisplay();
    });

    // --------- Initial setup ---------

    function init() {
      memDateInput.value = todayDateStr();
      vidDateInput.value = todayDateStr();
      taskDeadlineInput.value = todayDateStr();
      hDateInput.value = todayDateStr();
      hvDateInput.value = todayDateStr();

      updateHeader();
      updateTheme();
      renderHomeSlideshow();
      renderMemories();
      renderVideos();
      renderDreams();
      renderSongs();
      renderTasks();
      renderDiary();
      renderVoiceDiary();
      renderLetterDisplay();
      renderSettings();
      initBirthdayOverlay();
    }

    init();
  </script>
</body>
</html>
